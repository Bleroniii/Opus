<div class="absolute inset-0 flex flex-col min-w-0 overflow-hidden">

    <mat-drawer-container class="flex-auto h-full bg-card dark:bg-transparent" (backdropClick)="onBackdropClicked()">

        <!-- Drawer -->
        <mat-drawer class="w-full sm:w-128 dark:bg-gray-900" [mode]="drawerMode" [opened]="false" [position]="'end'"
            [disableClose]="false" #matDrawer>
            <router-outlet></router-outlet>
        </mat-drawer>

        <mat-drawer-content class="flex flex-col">

            <!-- Main -->
            <div class="flex flex-col flex-auto">

                <!-- Header -->
                <div class="flex flex-col sm:flex-row items-start sm:items-center sm:justify-between py-8 px-6 md:px-8">
                    <!-- Title -->
                    <div>

                        <div class="text-4xl font-extrabold tracking-tight leading-none">Tasks</div>
                        <div class="ml-0.5 font-medium text-secondary">
                            <span *ngIf="tasksCount.incomplete === 0">All tasks completed!</span>
                            <span *ngIf="tasksCount.incomplete !== 0">{{tasksCount.incomplete}} remaining tasks</span>
                        </div>
                    </div>
                    <!-- Actions -->
                    <div class="mt-4 sm:mt-0">
                        <!-- Add section button -->
                        <!-- <button
                            mat-flat-button
                            [color]="'accent'"

                            [matTooltip]="'Shortcut: Ctrl + .'">
                            <mat-icon [svgIcon]="'heroicons_outline:plus'"></mat-icon>
                            <span class="ml-2 mr-1">Get Departments</span>
                        </button>
                        <button
                            mat-flat-button
                            [color]="'accent'"
                            (click)="createTask('section')"
                            [matTooltip]="'Shortcut: Ctrl + .'">
                            <mat-icon [svgIcon]="'heroicons_outline:plus'"></mat-icon>
                            <span class="ml-2 mr-1">Add Section</span>
                        </button> -->
                        <!-- Add task button -->
                        <button class="ml-3" mat-flat-button [color]="'primary'" routerLink="add/new"
                            [matTooltip]="'Shortcut: Ctrl + /'">
                            <mat-icon [svgIcon]="'heroicons_outline:plus'"></mat-icon>
                            <span class="ml-2 mr-1">Add Task</span>
                        </button>

                    </div>
                </div>
                <div style="min-width: 1000px;">
                    <div *ngIf="departmentTasksWithStatusPriority$ | async">
                        <div [id]="'task-' + 2"
                            class="cdk-drag group w-full select-none hover:bg-gray-100 dark:hover:bg-hover border-t h-12 text-lg font-semibold bg-gray-50 dark:bg-transparent ng-star-inserted mt-5"
                            >

                           

                            <!-- Task content -->
                            <div class="relative flex items-center h-full pl-10">
                                <div class="flex flex-auto items-center min-w-0 h-full pr-7">
                                    <!-- Title & Placeholder -->
                                    <div class="flex-auto mr-2 truncate">
                                        <span>{{(departmentTasksWithStatusPriority$ | async).name}}</span>
                                    </div>

                                </div>
                            </div>
                        </div>
                        <ng-container *ngFor="let tas of (departmentTasksWithStatusPriority$ | async).tasks; let index = index; let first = first; trackBy: trackByFn">
                                <div [id]="'task-' + tas.id"
                                    class="cdk-drag group w-full select-none hover:bg-gray-100 dark:hover:bg-hover h-16 ng-star-inserted"
                                    [class.border-t]="first">
                                    <!-- Task content -->
                                    <div class="relative flex items-center h-full pl-4">
                                         <div class="subtasks" (click)="toggleTableRows(tas.id)" matBadgeColor="warn" [matBadge]="tas.subtasks_count" matBadgeSize="small" matBadgePosition="before">
                                            <mat-icon  [matTooltip]="'Subtasks'" [matTooltipPosition]="'above'" svgIcon="mat_solid:playlist_add" ></mat-icon>
                                        </div>

                                        <!-- Selected indicator -->
                                        <div>
                                            <div
                                                class="z-10 absolute -top-px right-0 -bottom-px flex flex-0 w-1 bg-primary">
                                            </div>
                                        </div>
                                        <!-- User -->
                                        <div class="flex items-center justify-center inset-y-0 left-0 me-3">
                                            <img [matTooltip]="tas.user.name" [matTooltipPosition]="'above'"
                                                style="width: 35px; height: 35px; border-radius: 50%; margin: 5px 0; object-fit: cover;"
                                                src="{{apiUrl+ 'storage/'+tas.user.user_image}}" alt="">
                                        </div>
                                        <!-- Task title -- link -->
                                        <div class="flex flex-auto items-center min-w-0 h-full pr-7" >
                                            <!-- Title & Placeholder -->
                                            <div class="flex-auto mr-2 truncate">
                                                <!-- ////////////////////// -->
                                                <editable (update)="updateField(index, 'title',tas.id)" style="cursor: pointer;">
                                                    <ng-template viewMode>
                                                        <p [routerLink]="" style="padding: 10px;">
                                                            {{tas.title}}{{tas.id}}
                                                        </p>
                                                    </ng-template>
                                                    <ng-template editMode>
                                                        <input style="padding: 5px; border: 1px dotted #00000070;" [formControl]="getControl(index, 'title')" focusable editableOnEnter>
                                                    </ng-template>
                                                </editable>
                                                <!-- ////////////////////// -->
                                                <!-- <span>{{tas.title}}</span> -->
                                            </div>
                                        </div>

                                        <!-- Users Assign -->
                                        <ng-container>
                                            <div class="checkListTable mr-4"
                                            [ngClass]="{
                                                'checkListTablegrey': tas.checkListInfo.completed !== tas.checkListInfo.total || tas.checkListInfo.total === 0,
                                                'checkListTablegreen': tas.checkListInfo.completed === tas.checkListInfo.total && tas.checkListInfo.total !== 0}">
                                                <mat-icon svgIcon="heroicons_outline:clipboard-check"></mat-icon>
                                                {{tas.checkListInfo.completed}}/{{tas.checkListInfo.total}}
                                            </div>
                                        </ng-container>
                                        <!-- Users Assign -->
                                        <ng-container
                                            *ngFor="let item of tas.users_assigned">
                                            <img [matTooltip]="item.name" [matTooltipPosition]="'above'"
                                                class="flex-0 w-8 h-8 rounded-full ring ring-offset-1 ring-bg-card ring-offset-transparent object-cover"
                                                [src]="apiUrl+ 'storage/' + item.image" alt="Member avatar">
                                        </ng-container>
                                        <!-- Users Assign -->
                                        <!-- Due date -->
                                        <div class="relative flex items-center mt-1.5 px-4 mx-2 leading-9 rounded-full priority_class"
                                            [ngClass]="{'text-gray-500 bg-gray-100 dark:text-gray-300 dark:bg-gray-700': !tas.deadline,
                                                    'text-green-800 bg-green-200 dark:text-green-100 dark:bg-green-500': tas.deadline && !isOverdue(tas.deadline),
                                                    'text-red-800 bg-red-200 dark:text-red-100 dark:bg-red-500': tas.deadline && isOverdue(tas.deadline)}"
                                                     >
                                            <mat-icon class="icon-size-5 text-current"
                                                [svgIcon]="'heroicons_solid:calendar'"></mat-icon>
                                            <span class="ml-2 text-md font-medium">
                                                <ng-container *ngIf="tas.deadline">{{tas.deadline |
                                                    date:'LLL dd yyyy'}}</ng-container>
                                                <ng-container *ngIf="!tas.deadline">Not set</ng-container>
                                            </span>
                                        </div>
                                        <!-- Priority -->
                                        <div [ngStyle]="{'background-color': tas.priority.color + '80'}"
                                            class="flex items-center mt-1.5 px-4 mx-2 leading-9 rounded-full  text-gray-800 dark:text-gray-100 priority_class"
                                            *ngIf="tas.priority"  [matMenuTriggerFor]="priorityMenu" (click)="triggerStatusMenu(tas)">
                                            <mat-icon class="icon-size-5 text-current" style="color: #000;"
                                                [svgIcon]="'heroicons_outline:view-grid-add'"></mat-icon>
                                                <div class="flex-auto mr-2 truncate">
                                                    <span class="ml-2 mr-1 text-md" style="color: #000;">{{tas.priority.name}}</span>
                                                </div>
                                        </div>
                                        <!-- Priority -->
                                        <!-- Status -->

                                        <div [ngStyle]="{'background-color': tas.status.color + '80'}"
                                                class="flex items-center mt-1.5 px-4 mx-2 leading-9 rounded-full text-gray-800 dark:text-gray-100 priority_class"
                                                *ngIf="tas.status" [matMenuTriggerFor]="stautsMenu" (click)="triggerStatusMenu(tas)">
                                                <mat-icon class="icon-size-5 text-current" style="color: #000;"
                                                    [svgIcon]="'heroicons_outline:clipboard-check'"></mat-icon>
                                                    <div class="flex-auto mr-2 truncate">
                                                <span class="ml-2 mr-1 text-md" style="color: #000;">{{tas.status.name}}</span>
                                                </div>
                                            </div>
                                        <!-- Status -->
                                    </div>
                                </div>
                                <div style="overflow: hidden;" class="subtask_list not_collapsed" [@detailExpand]="expandedSubtasks !== null && expandedSubtasks === tas.id ? 'expanded' : 'collapsed'" >
                                        <div *ngIf="expandedSubtasks === tas.id">
                                            <ng-container *ngFor="let subtaskTask of subtasksData$ | async; let first = first; trackBy: trackByFn">
                                                <div [id]="'task-' + subtaskTask.id"
                                                    class="cdk-drag group w-full select-none hover:bg-gray-100 dark:hover:bg-hover h-16 ng-star-inserted"
                                                    [class.border-t]="first">
                                                    <!-- Task content -->
                                                    <div class="relative flex items-center h-full pl-4">
                                                        <!-- Selected indicator -->
                                                        <div>
                                                            <div
                                                                class="z-10 absolute -top-px right-0 -bottom-px flex flex-0 w-1 bg-primary">
                                                            </div>
                                                        </div>
                                                        <!-- User -->
                                                        <div class="flex items-center justify-center inset-y-0 left-0 me-3">
                                                            <img [matTooltip]="subtaskTask.user.name" [matTooltipPosition]="'above'"
                                                                style="width: 35px; height: 35px; border-radius: 50%; margin: 5px 0; object-fit: cover;"
                                                                src="{{apiUrl+'storage/'+subtaskTask.user.user_image}}" alt="">
                                                        </div>
                                                        <!-- Task title -- link -->
                                                        <a class="flex flex-auto items-center min-w-0 h-full pr-7" [routerLink]="subtaskTask.id">
                                                            <!-- Title & Placeholder -->
                                                            <div class="flex-auto mr-2 truncate">
                                                                <span>{{subtaskTask.title}}</span>
                                                            </div>
                                                        </a>
                                                        
                                                        <ng-container
                                                            *ngFor="let subtaskitem of subtaskTask.users_assigned">
                                                            <img [matTooltip]="subtaskitem.name" [matTooltipPosition]="'above'"
                                                                class="flex-0 w-8 h-8 rounded-full ring ring-offset-1 ring-bg-card ring-offset-transparent object-cover"
                                                                [src]="apiUrl+ 'storage/' + subtaskitem.image" alt="Member avatar">
                                                        </ng-container>
                                                        <!-- Users Assign -->
                                                        <!-- Due date -->
                                                        <div class="relative flex items-center mt-1.5 px-4 mx-2 leading-9 rounded-full priority_class"
                                                            [ngClass]="{'text-gray-500 bg-gray-100 dark:text-gray-300 dark:bg-gray-700': !subtaskTask.deadline,
                                                                    'text-green-800 bg-green-200 dark:text-green-100 dark:bg-green-500': subtaskTask.deadline && !isOverdue(subtaskTask.deadline),
                                                                    'text-red-800 bg-red-200 dark:text-red-100 dark:bg-red-500': subtaskTask.deadline && isOverdue(subtaskTask.deadline)}">
                                                            <mat-icon class="icon-size-5 text-current"
                                                                [svgIcon]="'heroicons_solid:calendar'"></mat-icon>
                                                            <span class="ml-2 text-md font-medium">
                                                                <ng-container *ngIf="subtaskTask.deadline">{{subtaskTask.deadline |
                                                                    date:'LLL dd yyyy'}}</ng-container>
                                                                <ng-container *ngIf="!subtaskTask.deadline">Not set</ng-container>
                                                            </span>
                                                        </div>
                                                        <!-- Priority -->
                                                        <div [ngStyle]="{'background-color': subtaskTask.priority.color + '80'}"
                                                            class="flex items-center mt-1.5 px-4 mx-2 leading-9 rounded-full  text-gray-800 dark:text-gray-100 priority_class"
                                                            *ngIf="subtaskTask.priority">
                                                            <mat-icon class="icon-size-5 text-current" style="color: #000;"
                                                                [svgIcon]="'heroicons_outline:view-grid-add'"></mat-icon>
                                                                <div class="flex-auto mr-2 truncate">
                                                                    <span class="ml-2 mr-1 text-md" style="color: #000;">{{subtaskTask.priority.name}}</span>
                                                                </div>
                                                        </div>
                                                        <!-- Priority -->
                                                        <!-- Status -->
                                                        <div [ngStyle]="{'background-color': subtaskTask.status.color + '80'}"
                                                            class="flex items-center mt-1.5 px-4 mx-2 leading-9 rounded-full text-gray-800 dark:text-gray-100 priority_class"
                                                            *ngIf="subtaskTask.status">
                                                            <mat-icon class="icon-size-5 text-current" style="color: #000;"
                                                                [svgIcon]="'heroicons_outline:clipboard-check'"></mat-icon>
                                                                <div class="flex-auto mr-2 truncate">
                                                            <span class="ml-2 mr-1 text-md" style="color: #000;">{{subtaskTask.status.name}}</span>
                                                            </div>
                                                        </div>
                                                        <!-- Status -->
                                                    </div>
                                                </div>
                                            </ng-container>
                                        </div>
                                        <ng-container *ngIf="tas.subtasks_count === 0">
                                            <div class="py-3">
                                                <button class="ml-3" mat-flat-button [color]="'primary'" routerLink="add/new"
                                                    [matTooltip]="'Shortcut: Ctrl + /'">
                                                    <mat-icon [svgIcon]="'heroicons_outline:plus'"></mat-icon>
                                                    <span class="ml-2 mr-1">Add Subtask</span>
                                                </button>
                                            </div>
                                        </ng-container>
                                </div>
                            </ng-container>
                        
                        </div>
                </div>
                

            </div>

        </mat-drawer-content>

    </mat-drawer-container>

    <mat-menu #stautsMenu="matMenu">
        <!-- Low -->
        <button *ngFor="let status of statuses | async" mat-menu-item (click)="selectStatus(status)">
            <span class="inline-flex items-center justify-between w-full min-w-30 leading-5">
                <span class="font-medium" [ngStyle]="{'color': status.color}">{{status.name}}</span>
                <!-- <mat-icon
            class="mr-0 icon-size-4 text-green-600 dark:text-green-500"
            [svgIcon]="'heroicons_solid:arrow-narrow-down'"></mat-icon> -->
            </span>
        </button>
    </mat-menu>


    <mat-menu #priorityMenu="matMenu">
        <!-- Low -->
        <button *ngFor="let status of priority | async" mat-menu-item (click)="selectPriority(status)">
            <span class="inline-flex items-center justify-between w-full min-w-30 leading-5">
                <span class="font-medium" [ngStyle]="{'color': status.color}">{{status.name}}</span>
                <!-- <mat-icon
            class="mr-0 icon-size-4 text-green-600 dark:text-green-500"
            [svgIcon]="'heroicons_solid:arrow-narrow-down'"></mat-icon> -->
            </span>
        </button>
    </mat-menu>
    

   

    

    

</div>